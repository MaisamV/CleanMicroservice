plugins {
    id 'org.jetbrains.kotlin.jvm'
    id 'java'
    id "org.flywaydb.flyway" version "8.0.2"
}

group 'org.example'
version '1.0-SNAPSHOT'

repositories {
    mavenCentral()
    mavenLocal()
    google()
}

dependencies {
    implementation 'org.jetbrains.kotlin:kotlin-stdlib:1.5.31'

    implementation "org.flywaydb:flyway-core:8.0.2"
    implementation 'org.postgresql:postgresql:42.2.24.jre7'
}

test {
    useJUnitPlatform()
}

flyway {
    url = "jdbc:postgresql://${System.getenv("fund_db_host")}:${System.getenv("fund_db_port")}/${System.getenv("fund_db_name")}"
    user = System.getenv("fund_db_superuser_name")
    baselineOnMigrate = true
    password = System.getenv("fund_db_superuser_pass")
    locations = ['classpath:db/migration']
}

flywayMigrate.dependsOn classes